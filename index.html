<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EV MOTORS</title>
  <script src="https://cdn.jsdelivr.net/npm/react@18.3.1/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.3.1/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.26.7/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {}
      }
    }
  </script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
    .animate-fade-in { animation: fadeIn 0.5s ease-in; }
    .animate-slide-in { animation: slideIn 0.3s ease-out; }
    .skeleton { background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%); background-size: 200% 100%; animation: shimmer 1.5s infinite; }
    .image-placeholder { background: #e0e0e0; }
    .animate-spin { animation: spin 1s linear infinite; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }
    @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <div id="root">
    <div className="flex justify-center items-center h-screen">
      <div className="text-gray-600 dark:text-gray-300">Loading...</div>
    </div>
  </div>
  <script type="text/babel" data-presets="react">
    const { useState, useEffect, Component } = React;
    const { jsPDF } = window.jspdf;

    // Sample EV data
    const electricVehicles = [
      {
        id: 1,
        name: "BYD Seal Saloon",
        price: 30990,
        image: "https://www.topgear.com/sites/default/files/2023/12/1%20BYD%20Seal%20review.JPG?w=892&h=502",
        range: 405,
        description: "High-performance sedan with dual motors and autopilot.",
        topSpeed: "150 mph",
        rating: 5.0,
        safetyRating: 5.0,
        category: "Sedan",
        dealers: [
          { name: "BYD China Center", location: "China, Pingshan District" },
          { name: "BYD Hub", location: "Pingshan District" }
        ]
      },
      {
        id: 2,
        name: "Tesla Model S",
        price: 89990,
        image: "https://ev-database.org/img/auto/Tesla_Model_S_2016/Tesla_Model_S_2016-01@2x.jpg",
        range: 405,
        description: "High-performance sedan with dual motors and autopilot.",
        topSpeed: "200 mph",
        rating: 4.0,
        safetyRating: 4.0,
        category: "Sedan",
        dealers: [
          { name: "EcoDrive Tesla Center", location: "San Francisco, CA" },
          { name: "Tesla Urban Hub", location: "Los Angeles, CA" }
        ]
      },
      {
        id: 3,
        name: "Rivian R1T",
        price: 73000,
        image: "https://dbz-images.dubizzle.com/images/2025/01/11/e479c381a7ca44659dd6c41a082a80db-.jpeg?impolicy=lpv",
        range: 314,
        description: "Adventure-ready electric truck with off-road capabilities.",
        topSpeed: "125 mph",
        rating: 4.5,
        safetyRating: 4.0,
        category: "Truck",
        dealers: [
          { name: "GreenWheels Rivian", location: "Denver, CO" },
          { name: "Rivian Adventure Store", location: "Seattle, WA" }
        ]
      },
      {
        id: 4,
        name: "Polestar 2",
        price: 50990,
        image: "https://www.topgear.com/sites/default/files/2024/02/4-Polestar-2.jpeg?w=827&h=465",
        range: 405,
        description: "High-performance Polestar with dual motors.",
        topSpeed: "140 mph",
        rating: 3.0,
        safetyRating: 4.4,
        category: "SUV",
        dealers: [
          { name: "Polestar", location: "Paris, France" },
          { name: "Polestar Hub", location: "Paris" }
        ]
      },
      {
        id: 5,
        name: "Volvo EX90",
        price: 20090,
        image: "https://www.topgear.com/sites/default/files/2025/02/1-Volvo-EX90-review-2024-UK.jpg?w=827&h=465",
        range: 405,
        description: "High-performance with dual motors and autopilot.",
        topSpeed: "180 mph",
        rating: 2.0,
        safetyRating: 1.5,
        category: "Sedan",
        dealers: [
          { name: "Volvo Center", location: "Berlin, Germany" },
          { name: "Volvo", location: "Berlin, Germany" }
        ]
      },
      {
        id: 6,
        name: "Kia EV6",
        price: 60990,
        image: "https://www.topgear.com/sites/default/files/2025/02/Original-25901-aw609563.jpg?w=827&h=465",
        range: 405,
        description: "High-performance with dual motors and hybrid system integrated.",
        topSpeed: "220 mph",
        rating: 1.5,
        safetyRating: 3.5,
        category: "Sedan",
        dealers: [
          { name: "Kia", location: "California, USA" },
          { name: "Kia Center", location: "State of California" }
        ]
      },
      {
        id: 7,
        name: "Fiat Grande Panda",
        price: 80990,
        image: "https://www.topgear.com/sites/default/files/2025/02/5-Fiat-Grand-Panda-review-2025.jpg?w=827&h=465",
        range: 405,
        description: "High-performance sedan with dual motors and autopilot.",
        topSpeed: "250 mph",
        rating: 5.8,
        safetyRating: 5.5,
        category: "SUV",
        dealers: [
          { name: "Fiat", location: "Russia, Moscow" },
          { name: "Fiat Hub", location: "Moscow" }
        ]
      },
      {
        id: 8,
        name: "Chevrolet Silverado EV",
        price: 55990,
        image: "https://topelectricsuv.com/wp-content/uploads/2024/02/Chevrolet-Silverado-EV-RST-Black-front-three-quarter.jpg",
        range: 405,
        description: "High-performance truck with dual motors.",
        topSpeed: "390 mph",
        rating: 3.0,
        safetyRating: 3.0,
        category: "Truck",
        dealers: [
          { name: "Chevrolet", location: "Tokyo, Japan" },
          { name: "Chevrolet Center Hub", location: "Tokyo" }
        ]
      },
      {
        id: 9,
        name: "Tesla Cybertruck",
        price: 72220,
        image: "https://blog.japanesecartrade.com/wp-content/uploads/2020/04/Tesla-Cybertruck.png",
        range: 405,
        description: "High-performance sedan with dual motors and autopilot.",
        topSpeed: "350 mph",
        rating: 5.0,
        safetyRating: 3.0,
        category: "Truck",
        dealers: [
          { name: "Tesla", location: "USA, Texas" },
          { name: "Tesla", location: "Texas, USA" }
        ]
      },
      {
        id: 10,
        name: "GMC Hummer EV",
        price: 99090,
        image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRjLj2HI18tgUoftZShk6gBwQQZY44S_wDkTA&s",
        range: 405,
        description: "High-performance Truck.",
        topSpeed: "318 mph",
        rating: 5.0,
        safetyRating: 4.5,
        category: "Sedan",
        dealers: [
          { name: "GMC Hummer", location: "USA, New York City" },
          { name: "Hummer Hub", location: "New York City" }
        ]
      },
      {
        id: 11,
        name: "Ford Mustang Mach-E",
        price: 42995,
        image: "https://techcrunch.com/wp-content/uploads/2020/11/Ford-Mustang-Mach-E-2021-06.jpg",
        range: 247,
        description: "Sporty electric SUV with impressive acceleration.",
        topSpeed: "130 mph",
        rating: 4.0,
        safetyRating: 4.0,
        category: "SUV",
        dealers: [
          { name: "Ford Electric Depot", location: "Detroit, MI" }
        ]
      },
      {
        id: 12,
        name: "Lucid Air",
        price: 77400,
        image: "https://media.drivingelectric.com/image/private/s--X-WVjvBW--/f_auto,t_content-image-full-desktop@1/v1652263332/drivingelectric/2022-05/Lucid-Air-1_qya75u.jpg",
        range: 520,
        description: "Luxury sedan with unmatched range and elegance.",
        topSpeed: "168 mph",
        rating: 4.0,
        safetyRating: 4.5,
        category: "Sedan",
        dealers: [
          { name: "Lucid Luxury Motors", location: "Palo Alto, CA" },
          { name: "Elite Lucid Gallery", location: "Miami, FL" }
        ]
      }
    ];

    // Error Boundary Component
    class ErrorBoundary extends Component {
      state = { hasError: false };
      static getDerivedStateFromError() {
        return { hasError: true };
      }
      render() {
        if (this.state.hasError) {
          return (
            <div className="text-center mt-10">
              <h1 className="text-2xl text-red-600 font-semibold">Something went wrong</h1>
              <p className="text-gray-600 dark:text-gray-300">Please check the console for details.</p>
            </div>
          );
        }
        return this.props.children;
      }
    }

    // Toast Notification Component
    function Toast({ message, onClose }) {
      useEffect(() => {
        const timer = setTimeout(onClose, 3000);
        return () => clearTimeout(timer);
      }, [onClose]);
      return (
        <div className="fixed bottom-4 right-4 bg-green-600 text-white px-4 py-2 rounded-lg shadow-lg animate-fade-in flex items-center gap-2">
          <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M5 13l4 4L19 7" />
          </svg>
          {message}
        </div>
      );
    }

    // Skeleton Loader Component
    function ProductSkeleton() {
      return (
        <div className="border rounded-lg p-4 bg-white dark:bg-gray-800 shadow-lg">
          <div className="w-full h-40 sm:h-48 rounded skeleton image-placeholder"></div>
          <div className="mt-2 h-6 w-3/4 rounded skeleton"></div>
          <div className="mt-2 h-4 w-1/2 rounded skeleton"></div>
          <div className="mt-2 h-4 w-1/3 rounded skeleton"></div>
          <div className="mt-4 h-10 w-full rounded skeleton"></div>
        </div>
      );
    }

    // Star Rating Component
    function StarRating({ rating }) {
      const validRating = Number.isFinite(rating) && rating >= 0 && rating <= 5 ? rating : 0;
      return (
        <div className="flex items-center" role="img" aria-label={`Rating: ${validRating.toFixed(1)} out of 5 stars`}>
          {Array.from({ length: 5 }, (_, i) => (
            <svg
              key={i}
              className={`w-4 h-4 ${i < Math.round(validRating) ? 'text-yellow-400' : 'text-gray-300 dark:text-gray-600'}`}
              fill="currentColor"
              viewBox="0 0 20 20"
            >
              <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
            </svg>
          ))}
          <span className="ml-1 text-sm text-gray-500 dark:text-gray-400">({validRating.toFixed(1)})</span>
        </div>
      );
    }

    // Product Card Component
    function ProductCard({ vehicle, onAddToCart, onViewDetails, onAddToWishlist, onToggleCompare, isInWishlist, isInCompare }) {
      return (
        <div className="border rounded-lg p-4 bg-white dark:bg-gray-800 shadow-lg hover:shadow-xl transition transform hover:-translate-y-1 animate-fade-in">
          <div className="relative w-full h-48">
            <img
              src={vehicle.image}
              alt={vehicle.name}
              className="w-full h-full object-cover rounded"
              loading="lazy"
              onLoad={(e) => e.target.classList.add('animate-fade-in')}
              onError={(e) => e.target.src = 'https://via.placeholder.com/150'}
            />
            <div className="absolute top-2 right-2 flex gap-2">
              <button
                onClick={() => onAddToWishlist(vehicle)}
                className={`p-1 rounded-full ${isInWishlist ? 'bg-red-600 text-white' : 'bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200'}`}
                aria-label={isInWishlist ? `Remove ${vehicle.name} from wishlist` : `Add ${vehicle.name} to wishlist`}
              >
                <svg className="w-5 h-5" fill={isInWishlist ? 'currentColor' : 'none'} stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                </svg>
              </button>
              <button
                onClick={() => onToggleCompare(vehicle)}
                className={`p-1 rounded-full ${isInCompare ? 'bg-blue-600 text-white' : 'bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200'}`}
                aria-label={isInCompare ? `Remove ${vehicle.name} from comparison` : `Add ${vehicle.name} to comparison`}
              >
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M3 6h18M3 12h18M3 18h18" />
                </svg>
              </button>
            </div>
          </div>
          <h3 className="text-base sm:text-lg font-semibold mt-3 text-gray-900 dark:text-white">{vehicle.name}</h3>
          <StarRating rating={vehicle.rating} />
          <p className="text-gray-500 dark:text-gray-400 text-sm">Price: ${vehicle.price.toLocaleString()}</p>
          <p className="text-gray-500 dark:text-gray-400 text-sm">Range: {vehicle.range} miles</p>
          <p className="text-gray-500 dark:text-gray-400 text-sm">Safety Rating: {vehicle.safetyRating.toFixed(1)}/5</p>
          <p className="text-gray-500 dark:text-gray-400 text-sm truncate">
            Sold by: {vehicle.dealers[0]?.name || 'N/A'}
          </p>
          <div className="flex gap-2 mt-4">
            <button
              onClick={() => onAddToCart(vehicle)}
              className="flex-1 bg-gradient-to-r from-blue-600 to-blue-700 text-white px-3 py-2 sm:px-4 sm:py-2 rounded-lg hover:from-blue-700 hover:to-blue-800 transition text-xs sm:text-sm font-medium min-w-[80px] truncate"
              aria-label={`Add ${vehicle.name} to cart`}
            >
              Add to Cart
            </button>
            <button
              onClick={() => onViewDetails(vehicle)}
              className="flex-1 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200 px-3 py-2 sm:px-4 sm:py-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition text-xs sm:text-sm font-medium min-w-[80px] truncate"
              aria-label={`View details for ${vehicle.name}`}
            >
              Details
            </button>
          </div>
        </div>
      );
    }

    // Product Details Modal
    function ProductModal({ vehicle, onClose }) {
      if (!vehicle) return null;
      return (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
          <div className="bg-white dark:bg-gray-800 p-6 rounded-lg w-full max-w-lg sm:max-w-md animate-fade-in" role="dialog" aria-labelledby="modal-title" tabIndex="-1">
            <h2 id="modal-title" className="text-lg sm:text-xl font-bold text-gray-900 dark:text-white">{vehicle.name}</h2>
            <img src={vehicle.image} alt={vehicle.name} className="w-full h-64 object-cover rounded mt-4" loading="lazy" />
            <StarRating rating={vehicle.rating} />
            <p className="text-gray-600 dark:text-gray-300 mt-3 text-sm">Price: ${vehicle.price.toLocaleString()}</p>
            <p className="text-gray-600 dark:text-gray-300 text-sm">Range: {vehicle.range} miles</p>
            <p className="text-gray-600 dark:text-gray-300 text-sm">Top Speed: {vehicle.topSpeed}</p>
            <p className="text-gray-600 dark:text-gray-300 text-sm">Safety Rating: {vehicle.safetyRating.toFixed(1)}/5</p>
            <p className="text-gray-600 dark:text-gray-300 mt-2 text-sm">{vehicle.description}</p>
            <div className="mt-2">
              <h3 className="text-sm font-semibold text-gray-900 dark:text-white">Available at:</h3>
              <ul className="list-disc pl-5 text-sm text-gray-600 dark:text-gray-300">
                {vehicle.dealers.map((dealer, i) => (
                  <li key={i}>{dealer.name} - {dealer.location}</li>
                ))}
              </ul>
            </div>
            <button
              onClick={onClose}
              className="mt-4 bg-red-600 text-white px-3 py-2 sm:px-4 sm:py-2 rounded-lg w-full hover:bg-red-700 transition text-xs sm:text-sm font-medium min-w-[80px]"
              aria-label="Close modal"
            >
              Close
            </button>
          </div>
        </div>
      );
    }

    // Compare Modal Component
    function CompareModal({ vehicles, onClose, onRemoveFromCompare }) {
      if (!vehicles.length) return null;
      return (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
          <div className="bg-white dark:bg-gray-800 p-6 rounded-lg w-full max-w-4xl animate-fade-in overflow-x-auto" role="dialog" aria-labelledby="compare-title" tabIndex="-1">
            <h2 id="compare-title" className="text-lg sm:text-xl font-bold text-gray-900 dark:text-white mb-4">Compare Vehicles</h2>
            <table className="w-full text-sm text-gray-600 dark:text-gray-300">
              <thead>
                <tr className="border-b">
                  <th className="p-2 text-left"></th>
                  {vehicles.map((vehicle) => (
                    <th key={vehicle.id} className="p-2 text-left">
                      <div className="flex items-center justify-between">
                        <span>{vehicle.name}</span>
                        <button
                          onClick={() => onRemoveFromCompare(vehicle.id)}
                          className="text-red-600 hover:text-red-800"
                          aria-label={`Remove ${vehicle.name} from comparison`}
                        >
                          <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" />
                          </svg>
                        </button>
                      </div>
                    </th>
                  ))}
                </tr>
              </thead>
              <tbody>
                <tr className="border-b">
                  <td className="p-2 font-semibold">Image</td>
                  {vehicles.map((vehicle) => (
                    <td key={vehicle.id} className="p-2">
                      <img src={vehicle.image} alt={vehicle.name} className="w-24 h-16 object-cover rounded" loading="lazy" />
                    </td>
                  ))}
                </tr>
                <tr className="border-b">
                  <td className="p-2 font-semibold">Price</td>
                  {vehicles.map((vehicle) => (
                    <td key={vehicle.id} className="p-2">${vehicle.price.toLocaleString()}</td>
                  ))}
                </tr>
                <tr className="border-b">
                  <td className="p-2 font-semibold">Range</td>
                  {vehicles.map((vehicle) => (
                    <td key={vehicle.id} className="p-2">{vehicle.range} miles</td>
                  ))}
                </tr>
                <tr className="border-b">
                  <td className="p-2 font-semibold">Top Speed</td>
                  {vehicles.map((vehicle) => (
                    <td key={vehicle.id} className="p-2">{vehicle.topSpeed}</td>
                  ))}
                </tr>
                <tr className="border-b">
                  <td className="p-2 font-semibold">Rating</td>
                  {vehicles.map((vehicle) => (
                    <td key={vehicle.id} className="p-2">{vehicle.rating.toFixed(1)}/5</td>
                  ))}
                </tr>
                <tr className="border-b">
                  <td className="p-2 font-semibold">Safety Rating</td>
                  {vehicles.map((vehicle) => (
                    <td key={vehicle.id} className="p-2">{vehicle.safetyRating.toFixed(1)}/5</td>
                  ))}
                </tr>
                <tr>
                  <td className="p-2 font-semibold">Category</td>
                  {vehicles.map((vehicle) => (
                    <td key={vehicle.id} className="p-2">{vehicle.category}</td>
                  ))}
                </tr>
              </tbody>
            </table>
            <button
              onClick={onClose}
              className="mt-4 bg-red-600 text-white px-4 py-2 rounded-lg w-full hover:bg-red-700 transition text-sm font-medium"
              aria-label="Close comparison modal"
            >
              Close
            </button>
          </div>
        </div>
      );
    }

    // Wishlist Component
    function Wishlist({ wishlistItems, onRemoveFromWishlist, isOpen, toggleWishlist }) {
      return (
        <div className={`fixed bottom-0 right-0 sm:bottom-4 sm:right-4 bg-white dark:bg-gray-800 p-4 rounded-lg shadow-xl w-80 max-h-[70vh] overflow-y-auto transition-transform ${isOpen ? 'translate-x-0' : 'translate-x-full sm:translate-x-0'} animate-slide-in z-40`} role="dialog" aria-labelledby="wishlist-title">
          <div className="flex justify-between items-center mb-4">
            <h2 id="wishlist-title" className="text-base sm:text-lg font-semibold text-gray-900 dark:text-white">
              Wishlist ({wishlistItems.length} {wishlistItems.length === 1 ? 'item' : 'items'})
            </h2>
            <button
              onClick={toggleWishlist}
              className="sm:hidden text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-white"
              aria-label="Toggle wishlist visibility"
            >
              <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </div>
          {wishlistItems.length === 0 ? (
            <p className="text-gray-500 dark:text-gray-400 text-sm">Your wishlist is empty</p>
          ) : (
            <div>
              {wishlistItems.map((item) => (
                <div key={item.id} className="flex justify-between items-center py-2 border-b">
                  <span className="text-gray-900 dark:text-white text-sm truncate max-w-[200px]">{item.name}</span>
                  <button
                    onClick={() => onRemoveFromWishlist(item.id)}
                    className="text-red-600 hover:text-red-800 text-sm"
                    aria-label={`Remove ${item.name} from wishlist`}
                  >
                    <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                  </button>
                </div>
              ))}
            </div>
          )}
        </div>
      );
    }

    // Updated CheckoutModal Component with Payment Feedback
    function CheckoutModal({ cartItems, onClose, onConfirm }) {
      const [isProcessing, setIsProcessing] = useState(false);
      const [isConfirmed, setIsConfirmed] = useState(false);
      const total = cartItems.reduce((sum, item) => sum + item.price * item.quantity, 0);

      if (!cartItems.length) return null;

      const handleConfirm = async () => {
        setIsProcessing(true);
        // Simulate async payment processing
        await new Promise(resolve => setTimeout(resolve, 1500));
        setIsProcessing(false);
        setIsConfirmed(true);
        onConfirm();
      };

      return (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
          <div className="bg-white dark:bg-gray-800 p-6 rounded-lg w-full max-w-lg sm:max-w-md animate-fade-in" role="dialog" aria-labelledby="checkout-title" tabIndex="-1">
            {isConfirmed ? (
              <div className="text-center">
                <svg className="w-16 h-16 mx-auto text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M5 13l4 4L19 7" />
                </svg>
                <h2 id="checkout-title" className="text-lg sm:text-xl font-bold text-gray-900 dark:text-white mt-4">Payment Successful!</h2>
                <p className="text-gray-600 dark:text-gray-300 mt-2 text-sm">Your order has been confirmed. Thank you for shopping with EV Store!</p>
                <button
                  onClick={onClose}
                  className="mt-4 bg-blue-600 text-white px-3 py-2 sm:px-4 sm:py-2 rounded-lg w-full hover:bg-blue-700 transition text-xs sm:text-sm font-medium"
                  aria-label="Close checkout modal"
                >
                  Close
                </button>
              </div>
            ) : (
              <>
                <h2 id="checkout-title" className="text-lg sm:text-xl font-bold text-gray-900 dark:text-white">Checkout</h2>
                <div className="mt-4">
                  <h3 className="text-sm font-semibold text-gray-900 dark:text-white">Order Summary</h3>
                  <ul className="mt-2 text-sm text-gray-600 dark:text-gray-300">
                    {cartItems.map((item) => (
                      <li key={item.id} className="flex justify-between py-1">
                        <span>{item.name} (x{item.quantity})</span>
                        <span>${(item.price * item.quantity).toLocaleString()}</span>
                      </li>
                    ))}
                  </ul>
                  <p className="mt-3 font-semibold text-gray-900 dark:text-white">Total: ${total.toLocaleString()}</p>
                </div>
                <div className="mt-4 flex gap-2">
                  <button
                    onClick={handleConfirm}
                    disabled={isProcessing}
                    className={`flex-1 bg-gradient-to-r from-green-600 to-green-700 text-white px-3 py-2 sm:px-4 sm:py-2 rounded-lg hover:from-green-700 hover:to-green-800 transition text-xs sm:text-sm font-medium min-w-[100px] flex items-center justify-center ${isProcessing ? 'opacity-50 cursor-not-allowed' : ''}`}
                    aria-label="Confirm payment"
                    aria-busy={isProcessing}
                  >
                    {isProcessing ? (
                      <>
                        <svg className="w-5 h-5 mr-2 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 12a8 8 0 1116 0 8 8 0 01-16 0z" />
                        </svg>
                        Processing...
                      </>
                    ) : (
                      'Confirm Payment'
                    )}
                  </button>
                  <button
                    onClick={onClose}
                    disabled={isProcessing}
                    className="flex-1 bg-gradient-to-r from-red-600 to-red-700 text-white px-3 py-2 sm:px-4 sm:py-2 rounded-lg hover:from-red-700 hover:to-red-800 transition text-xs sm:text-sm font-medium min-w-[100px]"
                    aria-label="Cancel checkout"
                  >
                    Cancel
                  </button>
                </div>
              </>
            )}
          </div>
        </div>
      );
    }

    // Cart Component
    function Cart({ cartItems, onRemoveFromCart, onUpdateQuantity, isOpen, toggleCart, onCheckout, onExportPDF }) {
      const total = cartItems.reduce((sum, item) => sum + item.price * item.quantity, 0);
      const totalItems = cartItems.reduce((sum, item) => sum + item.quantity, 0);

      return (
        <div className={`fixed top-16 right-0 sm:top-20 sm:right-4 bg-white dark:bg-gray-800 p-4 rounded-lg shadow-xl w-80 max-h-[70vh] overflow-y-auto transition-transform ${isOpen ? 'translate-x-0' : 'translate-x-full sm:translate-x-0'} animate-slide-in z-40`} role="dialog" aria-labelledby="cart-title">
          <div className="flex justify-between items-center mb-4">
            <h2 id="cart-title" className="text-base sm:text-lg font-semibold text-gray-900 dark:text-white">
              Cart ({totalItems} {totalItems === 1 ? 'item' : 'items'})
            </h2>
            <button
              onClick={toggleCart}
              className="sm:hidden text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-white"
              aria-label="Toggle cart visibility"
            >
              <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </div>
          {cartItems.length === 0 ? (
            <p className="text-gray-500 dark:text-gray-400 text-sm">Your cart is empty</p>
          ) : (
            <div>
              {cartItems.map((item) => (
                <div key={item.id} className="flex justify-between items-center py-2 border-b">
                  <span className="text-gray-900 dark:text-white text-sm truncate max-w-[150px]">{item.name}</span>
                  <div className="flex items-center gap-2">
                    <button
                      onClick={() => onUpdateQuantity(item.id, item.quantity - 1)}
                      className="text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-white text-sm disabled:opacity-50"
                      disabled={item.quantity <= 1}
                      aria-label={`Decrease quantity of ${item.name}`}
                    >
                      -
                    </button>
                    <span className="text-gray-900 dark:text-white text-sm w-8 text-center">{item.quantity}</span>
                    <button
                      onClick={() => onUpdateQuantity(item.id, item.quantity + 1)}
                      className="text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-white text-sm"
                      aria-label={`Increase quantity of ${item.name}`}
                    >
                      +
                    </button>
                    <span className="text-gray-500 dark:text-gray-400 text-sm w-20 text-right">${(item.price * item.quantity).toLocaleString()}</span>
                    <button
                      onClick={() => onRemoveFromCart(item.id)}
                      className="text-red-600 hover:text-red-800 text-sm"
                      aria-label={`Remove ${item.name} from cart`}
                    >
                      <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" />
                      </svg>
                    </button>
                  </div>
                </div>
              ))}
              <p className="font-semibold mt-3 text-gray-900 dark:text-white text-sm">Total: ${total.toLocaleString()}</p>
              <button
                onClick={onExportPDF}
                className="mt-2 bg-blue-600 text-white px-3 py-2 sm:px-4 sm:py-2 rounded-lg w-full hover:bg-blue-700 transition text-xs sm:text-sm font-medium"
                aria-label="Export cart as PDF"
              >
                Export as PDF
              </button>
              <button
                onClick={onCheckout}
                className="mt-2 bg-gradient-to-r from-green-600 to-green-700 text-white px-3 py-2 sm:px-4 sm:py-2 rounded-lg w-full hover:from-green-700 hover:to-green-800 transition text-xs sm:text-sm font-medium"
                aria-label="Proceed to checkout"
              >
                Checkout
              </button>
            </div>
          )}
        </div>
      );
    }

    // Updated App Component with Enhanced Confirm Checkout
    function App() {
      const [cartItems, setCartItems] = useState(() => {
        const savedCart = localStorage.getItem('cartItems');
        return savedCart ? JSON.parse(savedCart) : [];
      });
      const [wishlistItems, setWishlistItems] = useState(() => {
        const savedWishlist = localStorage.getItem('wishlistItems');
        return savedWishlist ? JSON.parse(savedWishlist) : [];
      });
      const [compareItems, setCompareItems] = useState([]);
      const [toast, setToast] = useState(null);
      const [selectedVehicle, setSelectedVehicle] = useState(null);
      const [priceFilter, setPriceFilter] = useState(() => {
        const saved = localStorage.getItem('priceFilter');
        return saved ? JSON.parse(saved) : [0, 100000];
      });
      const [rangeFilter, setRangeFilter] = useState(() => {
        const saved = localStorage.getItem('rangeFilter');
        return saved ? JSON.parse(saved) : [0, 600];
      });
      const [ratingFilter, setRatingFilter] = useState(() => {
        const saved = localStorage.getItem('ratingFilter');
        return saved ? Number(saved) : 0;
      });
      const [categoryFilter, setCategoryFilter] = useState(() => {
        const saved = localStorage.getItem('categoryFilter');
        return saved || "All";
      });
      const [sortOption, setSortOption] = useState(() => {
        const saved = localStorage.getItem('sortOption');
        return saved || "default";
      });
      const [searchQuery, setSearchQuery] = useState("");
      const [isDarkMode, setIsDarkMode] = useState(() => {
        return localStorage.getItem('darkMode') === 'true';
      });
      const [isCartOpen, setIsCartOpen] = useState(true);
      const [isWishlistOpen, setIsWishlistOpen] = useState(false);
      const [isFilterOpen, setIsFilterOpen] = useState(false);
      const [isLoading, setIsLoading] = useState(true);
      const [isCheckoutOpen, setIsCheckoutOpen] = useState(false);
      const [isCompareOpen, setIsCompareOpen] = useState(false);
      const [searchSuggestions, setSearchSuggestions] = useState([]);

      useEffect(() => {
        document.documentElement.classList.toggle('dark', isDarkMode);
        localStorage.setItem('darkMode', isDarkMode);
        setTimeout(() => setIsLoading(false), 1000);
      }, [isDarkMode]);

      useEffect(() => {
        localStorage.setItem('cartItems', JSON.stringify(cartItems));
      }, [cartItems]);

      useEffect(() => {
        localStorage.setItem('wishlistItems', JSON.stringify(wishlistItems));
      }, [wishlistItems]);

      useEffect(() => {
        localStorage.setItem('priceFilter', JSON.stringify(priceFilter));
        localStorage.setItem('rangeFilter', JSON.stringify(rangeFilter));
        localStorage.setItem('ratingFilter', ratingFilter);
        localStorage.setItem('categoryFilter', categoryFilter);
        localStorage.setItem('sortOption', sortOption);
      }, [priceFilter, rangeFilter, ratingFilter, categoryFilter, sortOption]);

      useEffect(() => {
        if (searchQuery) {
          const suggestions = electricVehicles
            .filter(v => (
              v.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
              v.dealers.some(d => d.name.toLowerCase().includes(searchQuery.toLowerCase()))
            ))
            .slice(0, 5)
            .map(v => v.name);
          setSearchSuggestions(suggestions);
        } else {
          setSearchSuggestions([]);
        }
      }, [searchQuery]);

      const toggleDarkMode = () => {
        setIsDarkMode(prev => !prev);
      };

      const showToast = (message) => {
        setToast(message);
        setTimeout(() => setToast(null), 3000);
      };

      const addToCart = (vehicle) => {
        const existingItem = cartItems.find((item) => item.id === vehicle.id);
        if (existingItem) {
          setCartItems(
            cartItems.map((item) =>
              item.id === vehicle.id ? { ...item, quantity: item.quantity + 1 } : item
            )
          );
        } else {
          setCartItems([...cartItems, { ...vehicle, quantity: 1 }]);
        }
        showToast(`${vehicle.name} added to cart`);
        setIsCartOpen(true);
      };

      const removeFromCart = (id) => {
        const item = cartItems.find((item) => item.id === id);
        setCartItems(cartItems.filter((item) => item.id !== id));
        showToast(`${item.name} removed from cart`);
      };

      const updateQuantity = (id, quantity) => {
        if (quantity === 0) {
          removeFromCart(id);
          return;
        }
        setCartItems(
          cartItems.map((item) =>
            item.id === id ? { ...item, quantity } : item
          )
        );
      };

      const addToWishlist = (vehicle) => {
        const isInWishlist = wishlistItems.find((item) => item.id === vehicle.id);
        if (isInWishlist) {
          setWishlistItems(wishlistItems.filter((item) => item.id !== vehicle.id));
          showToast(`${vehicle.name} removed from wishlist`);
        } else {
          setWishlistItems([...wishlistItems, vehicle]);
          showToast(`${vehicle.name} added to wishlist`);
        }
        setIsWishlistOpen(true);
      };

      const removeFromWishlist = (id) => {
        const item = wishlistItems.find((item) => item.id === id);
        setWishlistItems(wishlistItems.filter((item) => item.id !== id));
        showToast(`${item.name} removed from wishlist`);
      };

      const toggleCompare = (vehicle) => {
        const isInCompare = compareItems.find((item) => item.id === vehicle.id);
        if (isInCompare) {
          setCompareItems(compareItems.filter((item) => item.id !== vehicle.id));
          showToast(`${vehicle.name} removed from comparison`);
        } else if (compareItems.length < 4) {
          setCompareItems([...compareItems, vehicle]);
          showToast(`${vehicle.name} added to comparison`);
        } else {
          showToast("Maximum 4 vehicles can be compared");
        }
      };

      const removeFromCompare = (id) => {
        const item = compareItems.find((item) => item.id === id);
        setCompareItems(compareItems.filter((item) => item.id !== id));
        showToast(`${item.name} removed from comparison`);
      };

      const exportCartAsPDF = () => {
        const doc = new jsPDF();
        doc.setFontSize(16);
        doc.text("Cart Summary", 20, 20);
        doc.setFontSize(12);
        let y = 30;
        cartItems.forEach((item) => {
          doc.text(`${item.name} (x${item.quantity}): $${(item.price * item.quantity).toLocaleString()}`, 20, y);
          y += 10;
        });
        const total = cartItems.reduce((sum, item) => sum + item.price * item.quantity, 0);
        doc.text(`Total: $${total.toLocaleString()}`, 20, y + 10);
        doc.save("cart_summary.pdf");
        showToast("Cart exported as PDF");
      };

      const handleCheckout = () => {
        setIsCheckoutOpen(true);
      };

      const confirmCheckout = () => {
        setCartItems([]);
        setIsCheckoutOpen(false);
        showToast("Payment confirmed! Cart cleared.");
      };

      const filteredVehicles = electricVehicles
        .filter((v) => v.price >= priceFilter[0] && v.price <= priceFilter[1])
        .filter((v) => v.range >= rangeFilter[0] && v.range <= rangeFilter[1])
        .filter((v) => v.rating >= ratingFilter)
        .filter((v) => categoryFilter === "All" || v.category === categoryFilter)
        .filter((v) => (
          v.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
          v.description.toLowerCase().includes(searchQuery.toLowerCase()) ||
          v.dealers.some(dealer => dealer.name.toLowerCase().includes(searchQuery.toLowerCase()))
        ))
        .sort((a, b) => {
          if (sortOption === "price-low") return a.price - b.price;
          if (sortOption === "price-high") return b.price - a.price;
          return 0;
        });

      return (
        <ErrorBoundary>
          <div className="min-h-screen bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-white transition-colors">
            <header className="sticky top-0 bg-gradient-to-r from-blue-900 to-blue-800 text-white p-4 shadow-lg z-50">
              <div className="container mx-auto flex justify-between items-center">
                <h1 className="text-lg sm:text-xl md:text-2xl font-bold">EV Store</h1>
                <div className="flex items-center gap-2 sm:gap-4">
                  <button
                    onClick={() => setIsFilterOpen(!isFilterOpen)}
                    className="sm:hidden text-white hover:text-gray-200"
                    aria-label="Toggle filters"
                  >
                    <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1m-4 8H3m10 8H3" />
                    </svg>
                  </button>
                  <button
                    onClick={() => setIsWishlistOpen(!isWishlistOpen)}
                    className="text-white hover:text-gray-200 relative"
                    aria-label="Toggle wishlist"
                  >
                    <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                    </svg>
                    {wishlistItems.length > 0 && (
                      <span className="absolute -top-1 -right-1 bg-red-600 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">
                        {wishlistItems.length}
                      </span>
                    )}
                  </button>
                  <button
                    onClick={() => setIsCartOpen(!isCartOpen)}
                    className="text-white hover:text-gray-200 relative"
                    aria-label="Toggle cart"
                  >
                    <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                    </svg>
                    {cartItems.length > 0 && (
                      <span className="absolute -top-1 -right-1 bg-red-600 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">
                        {cartItems.reduce((sum, item) => sum + item.quantity, 0)}
                      </span>
                    )}
                  </button>
                  <button
                    onClick={() => setIsCompareOpen(true)}
                    className="text-white hover:text-gray-200 relative"
                    aria-label="View comparison"
                    disabled={compareItems.length < 2}
                  >
                    <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M3 6h18M3 12h18M3 18h18" />
                    </svg>
                    {compareItems.length > 0 && (
                      <span className="absolute -top-1 -right-1 bg-blue-600 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">
                        {compareItems.length}
                      </span>
                    )}
                  </button>
                  <button
                    onClick={toggleDarkMode}
                    className="text-white hover:text-gray-200"
                    aria-label={isDarkMode ? "Switch to light mode" : "Switch to dark mode"}
                  >
                    <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d={isDarkMode ? "M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" : "M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"} />
                    </svg>
                  </button>
                </div>
              </div>
            </header>
            <main className="container mx-auto p-4 sm:p-6">
              <div className="mb-4 sm:mb-6 relative">
                <div className="relative max-w-md mx-auto sm:mx-0">
                  <input
                    type="text"
                    placeholder="Search vehicles, descriptions, or dealers..."
                    value={searchQuery}
                    onChange={(e) => setSearchQuery(e.target.value)}
                    className="w-full p-2 pl-10 border rounded-lg bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-700 text-gray-900 dark:text-white text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                    aria-label="Search vehicles, descriptions, or dealers"
                    autoComplete="off"
                  />
                  <svg className="w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                  </svg>
                  {searchSuggestions.length > 0 && (
                    <ul className="absolute z-10 w-full bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-lg mt-1 max-h-40 overflow-y-auto">
                      {searchSuggestions.map((suggestion, i) => (
                        <li
                          key={i}
                          className="p-2 text-sm text-gray-900 dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer"
                          onClick={() => setSearchQuery(suggestion)}
                        >
                          {suggestion}
                        </li>
                      ))}
                    </ul>
                  )}
                </div>
              </div>
              <div className={`mb-4 sm:mb-6 bg-white dark:bg-gray-800 p-4 sm:p-6 rounded-lg shadow-lg transition-all ${isFilterOpen ? 'block' : 'hidden sm:block'}`}>
                <h2 className="text-base sm:text-lg font-semibold mb-4 text-gray-900 dark:text-white">Filters</h2>
                <div className="grid grid-cols-1 sm:grid-cols-4 gap-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">Price Range</label>
                    <input
                      type="range"
                      min="0"
                      max="100000"
                      value={priceFilter[1]}
                      onChange={(e) => setPriceFilter([0, +e.target.value])}
                      className="w-full mt-1"
                      aria-label="Filter by price range"
                    />
                    <span className="text-sm text-gray-500 dark:text-gray-400">Up to ${priceFilter[1].toLocaleString()}</span>
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">Range (miles)</label>
                    <input
                      type="range"
                      min="0"
                      max="600"
                      value={rangeFilter[1]}
                      onChange={(e) => setRangeFilter([0, +e.target.value])}
                      className="w-full mt-1"
                      aria-label="Filter by range"
                    />
                    <span className="text-sm text-gray-500 dark:text-gray-400">Up to {rangeFilter[1]} miles</span>
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">Min Rating</label>
                    <input
                      type="range"
                      min="0"
                      max="5"
                      step="0.1"
                      value={ratingFilter}
                      onChange={(e) => setRatingFilter(+e.target.value)}
                      className="w-full mt-1"
                      aria-label="Filter by minimum rating"
                    />
                    <span className="text-sm text-gray-500 dark:text-gray-400">{ratingFilter.toFixed(1)} stars</span>
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">Category</label>
                    <select
                      value={categoryFilter}
                      onChange={(e) => setCategoryFilter(e.target.value)}
                      className="w-full p-2 mt-1 border rounded-lg bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-700 text-gray-900 dark:text-white text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                      aria-label="Filter by category"
                    >
                      <option value="All">All</option>
                      <option value="Sedan">Sedan</option>
                      <option value="Truck">Truck</option>
                      <option value="SUV">SUV</option>
                    </select>
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">Sort By</label>
                    <select
                      value={sortOption}
                      onChange={(e) => setSortOption(e.target.value)}
                      className="w-full p-2 mt-1 border rounded-lg bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-700 text-gray-900 dark:text-white text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                      aria-label="Sort vehicles"
                    >
                      <option value="default">Default</option>
                      <option value="price-low">Price: Low to High</option>
                      <option value="price-high">Price: High to Low</option>
                    </select>
                  </div>
                </div>
              </div>
              <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-6">
                {isLoading
                  ? Array(4).fill().map((_, i) => <ProductSkeleton key={i} />)
                  : filteredVehicles.map((vehicle) => (
                      <ProductCard
                        key={vehicle.id}
                        vehicle={vehicle}
                        onAddToCart={addToCart}
                        onViewDetails={setSelectedVehicle}
                        onAddToWishlist={addToWishlist}
                        onToggleCompare={toggleCompare}
                        isInWishlist={wishlistItems.some(item => item.id === vehicle.id)}
                        isInCompare={compareItems.some(item => item.id === vehicle.id)}
                      />
                    ))}
              </div>
            </main>
            <Wishlist
              wishlistItems={wishlistItems}
              onRemoveFromWishlist={removeFromWishlist}
              isOpen={isWishlistOpen}
              toggleWishlist={() => setIsWishlistOpen(!isWishlistOpen)}
            />
            <Cart
              cartItems={cartItems}
              onRemoveFromCart={removeFromCart}
              onUpdateQuantity={updateQuantity}
              isOpen={isCartOpen}
              toggleCart={() => setIsCartOpen(!isCartOpen)}
              onCheckout={handleCheckout}
              onExportPDF={exportCartAsPDF}
            />
            <ProductModal vehicle={selectedVehicle} onClose={() => setSelectedVehicle(null)} />
            <CheckoutModal
              cartItems={cartItems}
              onClose={() => setIsCheckoutOpen(false)}
              onConfirm={confirmCheckout}
            />
            <CompareModal
              vehicles={compareItems}
              onClose={() => setIsCompareOpen(false)}
              onRemoveFromCompare={removeFromCompare}
            />
            {toast && <Toast message={toast} onClose={() => setToast(null)} />}
          </div>
        </ErrorBoundary>
      );
    }

    // Render the app
    try {
      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    } catch (error) {
      console.error('Rendering failed:', error);
      document.getElementById('root').innerHTML = `
        <div className="text-center mt-10">
          <h1 className="text-2xl text-red-600 font-semibold">Failed to render app</h1>
          <p className="text-gray-600">Please check the console for details.</p>
        </div>
      `;
    }
  </script>
</body>
</html>